(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1ab41392"],{"243d":function(e,t,i){"use strict";var n=i("9a3c"),a=i.n(n);a.a},"3def":function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"publicity"},[i("bread-nav",{attrs:{nav:e.nav}}),i("main-part",[i("el-form",{ref:"form",staticClass:"form",attrs:{"label-position":"left",model:e.form,"label-width":"90px",rules:e.rules}},[i("el-form-item",{attrs:{label:"标题",prop:"title"}},[i("el-input",{staticStyle:{width:"50%"},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),i("el-form-item",{attrs:{label:"正文内容",prop:"content"}},[e.form.content||!e.id?i("wang-editor",{attrs:{content:e.form.content},on:{"update:content":function(t){e.$set(e.form,"content",t)}}}):e._e()],1),i("el-form-item",{attrs:{label:"视频"}},[i("div",{staticClass:"upload_view"},[i("div",{staticClass:"upload_view_list"}),i("div",{staticClass:"upload_view_button"},[i("uploader",{ref:"uploadZone",staticClass:"upload_view_btn",attrs:{options:e.uploadOptions,"file-status-text":e.fileStatusText}},[i("uploader-unsupport"),i("uploader-btn",{attrs:{attrs:e.attrs}},[e._v("上传文件")]),e._l(e.form.attachmentList,function(t,n){return i("div",{staticClass:"item"},[i("span",[e._v("视频"+e._s(n+1)+"："),i("a",{attrs:{href:t.fileUrl}},[e._v(e._s(t.fileName))])]),i("i",{staticClass:"el-icon-close",on:{click:function(t){e.removeEnd(n)}}})])}),i("uploader-list")],2)],1)])]),i("el-form-item",{attrs:{label:"推送范围",prop:"scopeList"}},[i("el-input",{staticClass:"input",staticStyle:{width:"440px"},attrs:{placeholder:"请选择范围",disabled:""},model:{value:e.selectedDepName.join(),callback:function(t){e.$set(e.selectedDepName,"join()",t)},expression:"selectedDepName.join()"}},[i("el-button",{staticClass:"hende",attrs:{slot:"append"},on:{click:e.showDepDialog},slot:"append"},[e._v("选择范围")])],1)],1)],1),i("el-dialog",{staticClass:"dep-dialog",attrs:{visible:e.depDialog,width:"400px"},on:{"update:visible":function(t){e.depDialog=t}}},[i("div",{staticClass:"dep-form"},[i("p",{staticClass:"title"},[e._v(e._s(e.depTitle))]),i("div",{staticClass:"content"},[i("el-tree",{attrs:{data:e.depData,props:e.props,"show-checkbox":"","node-key":"orgId","default-checked-keys":e.selectedDep},on:{"check-change":e.handleCheckChange}})],1)]),i("div",{staticStyle:{"text-align":"center","margin-top":"20px"}},[i("div",{staticClass:"btn-submit",on:{click:function(t){e.depDialog=!1}}},[e._v("关闭")])])]),i("div",{staticClass:"btns"},[i("div",{staticClass:"btn-submit",on:{click:function(t){e.doSubmit()}}},[e._v("确定")]),i("div",{staticClass:"btn-clear",staticStyle:{"margin-left":"30px"},on:{click:function(t){e.$router.go(-1)}}},[e._v("返回")])])],1)],1)},a=[],s=(i("ac6a"),i("f3e2"),i("57e7"),i("759f"),i("7f7f"),i("96cf"),i("1da1")),r=(i("a481"),i("5967")),o={components:{item:r["a"]},data:function(){var e=this,t=function(e,t,i){t&&"<p><br></p>"!==t?i():i(new Error("请输入正文内容"))},i=function(t,i,n){0===e.selectedDepName.length?n(new Error("请选择推送范围")):n()},n=this;return{table:{url:"/user/queryParentPage.do",el:".table",total:0,noData:!0,list:[],query:{gradeId:1,classId:1}},id:n.$route.query.id,tabPick:n.$route.query.tabPick,announcementDetail:[],nav:[{name:"通知公告",path:"go(-1)"},{name:"发布公告",path:""}],text:"发布成功",depDialog:!1,depTitle:"",depData:[],selectedDep:[],selectedDepName:[],form:{title:null,content:null,scopeList:[],noticeType:null,attachmentList:[]},attachmentList:[],attrs:{accept:"video/*"},rules:{title:{required:!0,message:"请输入标题",trigger:"blur"},content:{required:!0,validator:t,trigger:"change"},scopeList:{required:!0,validator:i,trigger:"change"}},uploadOptions:{target:"".concat(window.location.origin).concat(this.$conf.API_PATH,"/uploadFileTrunk/trunkUpload.do"),testChunks:!1,chunkSize:2097152,singleFile:!1,parseTimeRemaining:function(e,t){return t.replace(/\syears?/,"年").replace(/\days?/,"天").replace(/\shours?/,"小时").replace(/\sminutes?/,"分钟").replace(/\sseconds?/,"秒")}},fileStatusText:{success:"上传成功",error:"上传错误",uploading:"正在上传",paused:"已暂停",waiting:"等待中"},dialogVisible:!1,props:{label:"orgName",children:"subOrgList"}}},mounted:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getAllDep();case 2:this.$nextTick(function(){var e=t.$refs.uploadZone;if(e){var i=e.uploader;i.on("fileSuccess",function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(i,n,a){var s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$ajax({url:"/uploadFileTrunk/mergeChunks.do",query:{fileMd5:n.uniqueIdentifier,fileName:n.name}});case 2:s=e.sent,t.attachmentList.push({fileName:n.name,fileUrl:s});case 4:case"end":return e.stop()}},e,this)}));return function(t,i,n){return e.apply(this,arguments)}}()),i.on("fileRemoved",function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(i){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t.attachmentList.some(function(e,n){if(e.name===i.name)return t.attachmentList.splice(n,1),!0});case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}())}}),this.id&&this.getDetail();case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),watch:{"table.query.gradeId":function(){this.onClassList()},"form.content":function(){var e=this;this.id&&setTimeout(function(){e.$refs.form.validate()},1)},"form.title":function(){var e=this;this.id&&setTimeout(function(){e.$refs.form.validate()},1)}},methods:{handleCheckChange:function(e,t,i){var n=this.selectedDep.indexOf(e.orgId);t?(this.selectedDep.push(e.orgId),this.selectedDepName.push(e.orgName)):(this.selectedDep.splice(n,1),this.selectedDepName.splice(n,1))},removeEnd:function(e){this.form.attachmentList.splice(e,1)},getAllDep:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,i,n,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return a=function(e,t){return e.forEach(function(e){e.tier=t,e.status=!1,e.subOrgList.length>0&&a(e.subOrgList,t+1)}),e},t={orgTypes:["ADMIN_ORG","TEACH_ORG"]},"parentalNotice"===this.tabPick&&(t={orgTypes:["PARENT_ORG"]}),e.next=5,this.$ajax({url:"/org/queryOrganizationTree.do",query:t});case 5:i=e.sent,"parentalNotice"===this.tabPick?(this.depTitle=i.orgName,this.depData=a(i.subOrgList,1)):(n=[],n.push(i),this.depTitle=n[0].orgName,this.depData=a(n,1));case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),getDetail:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$ajax({url:"/notice/getNotice.do",el:".form",query:{id:this.id}});case 2:this.announcementDetail=e.sent,this.form.title=this.announcementDetail.title,this.form.content=this.announcementDetail.content,this.form.noticeType=this.announcementDetail.noticeType,this.announcementDetail.scopeList.forEach(function(e){t.selectedDep.push(e.businessId),t.selectedDepName.push(e.scopeName)}),this.form.attachmentList=this.announcementDetail.attachmentList;case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),showDepDialog:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.depDialog=!0;case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),doSubmit:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$refs.form.validate();case 2:return"announcement"===this.tabPick?this.form.noticeType="NOTICE":"schoolRegulations"===this.tabPick?this.form.noticeType="SCHOOL_RULE":this.form.noticeType="PATRIARCH_NOTICE",this.attachmentList.length&&(this.form.attachmentList=this.form.attachmentList.concat(this.attachmentList)),this.form.scopeList=this.selectedDep,t="/notice/addNotice.do",this.id&&(this.text="修改成功",t="/notice/updateNotice.do",this.form.id=this.id,delete this.form.noticeType),e.next=9,this.$ajax({url:t,el:".form",query:this.form});case 9:this.$remind(this.text),this.$router.push("/school/announcement?tabPick="+this.tabPick);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}},c=o,l=(i("f680"),i("2877")),u=Object(l["a"])(c,n,a,!1,null,"30ca1575",null);u.options.__file="Publicity.vue";t["default"]=u.exports},5967:function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"form-item"},e._l(e.treeData,function(t){return i("div",[i("div",{class:["item",{hand:t.subOrgList.length||1===t.parentOrgId}],style:{paddingLeft:25*(t.tier-1)+10+"px"},on:{click:function(e){t.status=!t.status}}},[i("i",{class:[{rotate:t.status},"el-icon-caret-right"],style:{visibility:t.subOrgList.length?"visible":"hidden"}}),i("el-checkbox",{attrs:{value:e.judge(t.orgId)},on:{change:function(i){e.changeDep(t)}}},[i("span",[e._v(e._s(t.orgName))])])],1),i("el-collapse-transition",[i("item",{directives:[{name:"show",rawName:"v-show",value:t.status,expression:"item.status"}],attrs:{selectedDepName:e.selectedDepName,selectedDep:e.selectedDep,data:t.subOrgList}})],1)],1)}))},a=[],s=(i("57e7"),i("5488")),r=i.n(s),o={components:{elCollapseTransition:r.a},props:["data","selectedDep","selectedDepName"],name:"item",data:function(){return{}},computed:{treeData:function(){return this.data},treeSelectedDep:function(){return this.selectedDep},treeSelectedDepName:function(){return this.selectedDepName||[]}},methods:{changeDep:function(e){var t=this.treeSelectedDep.indexOf(e.orgId);-1===t?(this.treeSelectedDep.push(e.orgId),this.treeSelectedDepName.push(e.orgName)):(this.treeSelectedDep.splice(t,1),this.treeSelectedDepName.splice(t,1)),this.$emit("update:selectedDep",this.treeSelectedDep),this.$emit("update:selectedDepName",this.treeSelectedDepName)},judge:function(e){return-1!==this.treeSelectedDep.indexOf(e)}},mounted:function(){}},c=o,l=(i("243d"),i("2877")),u=Object(l["a"])(c,n,a,!1,null,"97780030",null);u.options.__file="Item.vue";t["a"]=u.exports},"759f":function(e,t,i){"use strict";var n=i("5ca1"),a=i("0a49")(3);n(n.P+n.F*!i("2f21")([].some,!0),"Array",{some:function(e){return a(this,e,arguments[1])}})},8343:function(e,t,i){},"9a3c":function(e,t,i){},f680:function(e,t,i){"use strict";var n=i("8343"),a=i.n(n);a.a}}]);
//# sourceMappingURL=chunk-1ab41392.bb0f79fe.js.map