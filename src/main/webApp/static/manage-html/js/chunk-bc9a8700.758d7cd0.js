(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-bc9a8700"],{"243d":function(t,e,s){"use strict";var i=s("9a3c"),n=s.n(i);n.a},"2caf":function(t,e,s){var i=s("5ca1");i(i.S,"Array",{isArray:s("1169")})},5967:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"form-item"},t._l(t.treeData,function(e){return s("div",[s("div",{class:["item",{hand:e.subOrgList.length||1===e.parentOrgId}],style:{paddingLeft:25*(e.tier-1)+10+"px"},on:{click:function(t){e.status=!e.status}}},[s("i",{class:[{rotate:e.status},"el-icon-caret-right"],style:{visibility:e.subOrgList.length?"visible":"hidden"}}),s("el-checkbox",{attrs:{value:t.judge(e.orgId)},on:{change:function(s){t.changeDep(e)}}},[s("span",[t._v(t._s(e.orgName))])])],1),s("el-collapse-transition",[s("item",{directives:[{name:"show",rawName:"v-show",value:e.status,expression:"item.status"}],attrs:{selectedDepName:t.selectedDepName,selectedDep:t.selectedDep,data:e.subOrgList}})],1)],1)}))},n=[],a=(s("57e7"),s("5488")),r=s.n(a),o={components:{elCollapseTransition:r.a},props:["data","selectedDep","selectedDepName"],name:"item",data:function(){return{}},computed:{treeData:function(){return this.data},treeSelectedDep:function(){return this.selectedDep},treeSelectedDepName:function(){return this.selectedDepName||[]}},methods:{changeDep:function(t){var e=this.treeSelectedDep.indexOf(t.orgId);-1===e?(this.treeSelectedDep.push(t.orgId),this.treeSelectedDepName.push(t.orgName)):(this.treeSelectedDep.splice(e,1),this.treeSelectedDepName.splice(e,1)),this.$emit("update:selectedDep",this.treeSelectedDep),this.$emit("update:selectedDepName",this.treeSelectedDepName)},judge:function(t){return-1!==this.treeSelectedDep.indexOf(t)}},mounted:function(){}},c=o,u=(s("243d"),s("2877")),l=Object(u["a"])(c,i,n,!1,null,"97780030",null);l.options.__file="Item.vue";e["a"]=l.exports},"78ce":function(t,e,s){var i=s("5ca1");i(i.S,"Date",{now:function(){return(new Date).getTime()}})},"9a3c":function(t,e,s){},adf5:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("bread-nav",{attrs:{nav:t.nav}}),s("div",{staticClass:"card"},[s("div",{staticClass:"section"},[s("h1",{staticClass:"section__title"},[t._v("标题")]),s("el-input",{attrs:{placeholder:"标题"},model:{value:t.submit.title,callback:function(e){t.$set(t.submit,"title",e)},expression:"submit.title"}})],1),s("div",{staticClass:"section"},[s("h1",{staticClass:"section__title"},[t._v("正文内容")]),s("wang-editor",{attrs:{content:t.submit.content},on:{"update:content":function(e){t.$set(t.submit,"content",e)}}})],1),s("div",{staticClass:"section"},[s("h1",{staticClass:"section__title"},[t._v("题目")]),t._l(t.submit.questionList,function(e,i){return s("div",{key:i,staticClass:"section__content bg-gray"},[s("h1",{staticClass:"section__title"},[s("span",[t._v("题目"+t._s(i+1))]),s("span",{staticClass:"section__subtitle"},[t._v(t._s(t.$enums.SurveyQuestionType.getName(e.questionType)))]),s("span",{directives:[{name:"show",rawName:"v-show",value:t.submit.questionList.length>1,expression:"submit.questionList.length > 1"}],staticClass:"section__btn section__btn--delete",on:{click:function(e){t.doDeleteQuestion(i)}}},[t._v("删除题目")])]),s("el-input",{attrs:{placeholder:"此处填写题目内容"},model:{value:e.title,callback:function(s){t.$set(e,"title",s)},expression:"question.title"}}),e.optionList.length?s("div",{staticClass:"section"},[s("h1",{staticClass:"section__title"},[s("span",[t._v("选项")]),s("span",{staticClass:"section__subtitle"},[t._v("单/多选题的选项范围从2至20")]),s("span",{staticClass:"section__btn",on:{click:function(e){t.doAddOption(i)}}},[t._v("添加选项")])]),t._l(e.optionList,function(n,a){return s("div",{key:a,staticClass:"section__question"},[s("span",{staticClass:"el-radio"},[t._v(t._s(String.fromCharCode(a+65)+"、"))]),s("el-input",{model:{value:e.optionList[a],callback:function(s){t.$set(e.optionList,a,s)},expression:"question.optionList[optionIdx]"}}),s("i",{directives:[{name:"show",rawName:"v-show",value:a>1,expression:"optionIdx > 1"}],staticClass:"el-icon-delete",on:{click:function(e){t.doDeleteOption(i,a)}}})],1)})],2):t._e()],1)}),s("el-dropdown",{on:{command:t.doAddQuestion}},[s("span",{staticClass:"btn-submit",attrs:{type:"primary"}},[t._v("\n          添加问题"),s("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),s("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.$enums.SurveyQuestionType.list,function(e,i){return s("el-dropdown-item",{key:i,attrs:{command:e.value}},[t._v("\n            "+t._s(e.label)+"\n          ")])}))],1)],2),s("div",{staticClass:"section"},[s("h1",{staticClass:"section__title"},[t._v("截止时间")]),s("el-date-picker",{staticClass:"fixed-width",attrs:{type:"date","picker-options":t.pickerOptions,"value-format":"yyyy-MM-dd 00:00:00"},model:{value:t.submit.endTime,callback:function(e){t.$set(t.submit,"endTime",e)},expression:"submit.endTime"}})],1),s("div",{staticClass:"section"},[s("h1",{staticClass:"section__title"},[t._v("推送范围")]),s("el-input",{staticClass:"fixed-width",attrs:{disabled:"",placeholder:"请选择推送范围"},model:{value:t.selectedDepName.join(),callback:function(e){t.$set(t.selectedDepName,"join()",e)},expression:"selectedDepName.join()"}},[s("span",{staticClass:"btn-submit",attrs:{slot:"append"},on:{click:function(e){t.depDialog=!0}},slot:"append"},[t._v("选择")])])],1),s("div",{staticClass:"btn-group"},[s("span",{staticClass:"btn-submit",on:{click:t.doSubmit}},[t._v("确定")])])]),s("el-dialog",{staticClass:"dialog",attrs:{visible:t.depDialog,width:"400px"},on:{"update:visible":function(e){t.depDialog=e}}},[s("div",{staticClass:"dep-form"},[s("p",{staticClass:"title"},[t._v(t._s(t.depTitle))]),s("div",{staticClass:"content"},[s("el-tree",{attrs:{data:t.depData,props:t.props,"show-checkbox":"","node-key":"orgId","default-checked-keys":t.submit.orgIdList},on:{"check-change":t.handleCheckChange}})],1),s("div",{staticClass:"btns"},[s("div",{staticClass:"btn-submit",on:{click:function(e){t.depDialog=!1}}},[t._v("关闭")])])])])],1)},n=[],a=(s("2caf"),s("ac6a"),s("f3e2"),s("57e7"),s("96cf"),s("1da1")),r=(s("78ce"),s("5967")),o={components:{item:r["a"]},data:function(){return{nav:[{name:"调查问卷",path:"go(-1)"},{name:"发布",path:""}],pickerOptions:{disabledDate:function(t){return t.getTime()<Date.now()}},depDialog:!1,depTitle:"家长组",depData:[],selectedDep:[],selectedDepName:[],submit:{title:null,content:null,endTime:new Date((new Date).getTime()+864e5).$Format("yyyy-MM-dd 00:00:00"),orgIdList:[],questionList:[]},props:{label:"orgName",children:"subOrgList"}}},mounted:function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.submit.questionList.push(this.createQuestion(this.$enums.SurveyQuestionType.list[0].value)),t.next=3,this.$ajax({url:"/org/queryOrganizationTree.do",query:{orgTypes:["PARENT_ORG"]}});case 3:e=t.sent,this.depData=this.recursion(e.subOrgList,1);case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),methods:{handleCheckChange:function(t,e,s){var i=this.submit.orgIdList.indexOf(t.orgId);e?(this.submit.orgIdList.push(t.orgId),this.selectedDepName.push(t.orgName)):(this.submit.orgIdList.splice(i,1),this.selectedDepName.splice(i,1))},recursion:function(t,e){var s=this;return t.forEach(function(t){t.tier=e,t.status=!1,t.subOrgList.length>0&&s.recursion(t.subOrgList,e+1)}),t},createQuestion:function(t){var e={title:null,questionType:null,optionList:[]},s=0;switch(t){case"RADIO":case"MULTIPLE":s=3;break;case"COMPLETION":s=0;break;default:s=0;break}for(var i=0;i<s;i++)e.optionList.push("");return e.questionType=t,e},doDeleteQuestion:function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(1!==this.submit.questionList.length){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,this.$confirm("确认删除该题目? 删除后无法恢复","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});case 4:this.submit.questionList.splice(e,1);case 5:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),doAddQuestion:function(t){var e=this.createQuestion(t);this.submit.questionList.push(e)},doAddOption:function(t){this.submit.questionList[t].optionList.push("")},doDeleteOption:function(t,e){this.submit.questionList[t].optionList.splice(e,1)},validQuestionTitle:function(){var t=this;return this.submit.questionList.every(function(e,s){return!!e.title||(t.$message.warning("请填写题目".concat(s+1,"的题目内容")),!1)})},validOption:function(){var t=this;return this.submit.questionList.every(function(e,s){return"COMPLETION"===e.questionType||e.optionList.every(function(e,i){return!!e||(t.$message.warning("请填写题目".concat(s+1,"的").concat(String.fromCharCode(i+65),"选项")),!1)})})},doSubmit:function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(){var e,s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(e=this.submit,e.title){t.next=6;break}return this.$message.warning("请输入标题"),t.abrupt("return");case 6:if(e.content&&"<p><br></p>"!==e.content){t.next=11;break}return this.$message.warning("请输入正文内容"),t.abrupt("return");case 11:if(this.validQuestionTitle()){t.next=15;break}return t.abrupt("return");case 15:if(this.validOption()){t.next=19;break}return t.abrupt("return");case 19:if(e.orgIdList.length){t.next=22;break}return this.$message.warning("请选择推送范围"),t.abrupt("return");case 22:return s=this.$loading({target:".card",text:"数据提交中...."}),t.next=25,this.$ajax({url:"/survey/addSurvey.do",query:this.submit});case 25:s.close(),this.$remind("发布"),this.$router.back();case 28:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}},c=o,u=(s("c184"),s("2877")),l=Object(u["a"])(c,i,n,!1,null,"ca862716",null);l.options.__file="Add.vue";e["default"]=l.exports},b4d0:function(t,e,s){},c184:function(t,e,s){"use strict";var i=s("b4d0"),n=s.n(i);n.a}}]);
//# sourceMappingURL=chunk-bc9a8700.758d7cd0.js.map